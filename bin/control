#!/bin/bash -e
source $OPENSHIFT_CARTRIDGE_SDK_BASH


function start() {
  if [ -z "${NEWRELIC_LICENSE_KEY}" ]; then
    echo "ERROR: You need to set the NEWRELIC_LICENSE_KEY before starting cartridge."
    echo "       rhc env set NEWRELIC_LICENSE_KEY=key"
    echo "       rhc cartridge restart newrelic-sysmond -a ${OPENSHIFT_APP_NAME}"
    echo
  else
    echo "Starting NewRelic-sysmond cartridge"
    ${OPENSHIFT_NEWRELIC_SYSMOND_DIR}bin/nrsysmond \
	-c ${OPENSHIFT_NEWRELIC_SYSMOND_DIR}conf/nrsysmond.cfg
  fi
}

function stop() {
    echo "Stopping NewRelic-sysmond cartridge"
	killall nrsysmond
}

function restart() {
	stop
    start
}

case "$1" in
  start)     start ;;
  stop)      stop ;;
  restart)   restart ;;
  *)         exit 0
esac